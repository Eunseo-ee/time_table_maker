<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="header.css" />
  <link rel="stylesheet" href="table.css" />
  <title>에브리타임</title>
  <link rel="icon" href="https://play-lh.googleusercontent.com/0oDBGRaLXdz92kZGHpCNts6KQUr38rG4uCTrV8_32WEyMy70tzC5CM5KbPk3yFoVrwM"/>
</head>
<body>

<header>
  <div class="container">

    <div class="logo">
      <img
              src="https://play-lh.googleusercontent.com/0oDBGRaLXdz92kZGHpCNts6KQUr38rG4uCTrV8_32WEyMy70tzC5CM5KbPk3yFoVrwM"
      />
      <p>
        <span>에브리타임</span>
        <span>서울과기대</span>
      </p>
    </div>

    <div class="menu">
      <ul>
        <li><a href="/">게시판</a></li>
        <li>
          <a href="https://web-develop-uxcio.run.goorm.site/Web_develop/EVERYTIMECLONE/HTML.html">시간표</a>
        </li>
        <li><a href="/">강의실</a></li>
        <li><a href="/">학점계산기</a></li>
        <li><a href="/">친구</a></li>
        <li><a href="/">책방</a></li>
        <li><a href="/">캠퍼스픽</a></li>
      </ul>
    </div>
    <div class="icon">
      <img src="https://cdn-icons-png.flaticon.com/512/1159/1159740.png" />
      <img src="https://cdn-icons-png.flaticon.com/512/66/66933.png" />
    </div>
  </div>
</header>

<main>
  <div class="container1">
    <aside>
      <form class="select">
        <select id="semesters"
        ><option>2024년 겨울학기</option
        ><option>2024년 2학기</option>
        </select>
      </form>
      <div class="current"> //현재 시간표에 대한 부분
        <p>시간표 1</p>
      </div>
      <div class="choice"> //시간표를 선택할 수 있는 부분
        <ul>
          <a href=''><li><span>시간표1</span></li></a>
          <a href=''><li><span>시간표2</span></li></a>
          <a href=''><li><span>시간표3</span></li></a>
          <a href=''><li><span>
							새 시간표 만들기
							</span></li></a>
        </ul>
      </div>
    </aside>
    <table>
      <colgroup>
        <col class="col1" />
        <col class="col2" />
        <col class="col3" />
        <col class="col4" />
        <col class="col5" />
        <col class="col6" />
        <col class="col7" />
      </colgroup>
      <tr class="thead">
        <td></td>
        <td>월</td>
        <td>화</td>
        <td>수</td>
        <td>목</td>
        <td>금</td>
      </tr>
      <tr>
        <td>1교시</td>
        <td id="mon-1"></td>
        <td id="tue-1"></td>
        <td id="wed-1"></td>
        <td id="thu-1"></td>
        <td id="fri-1"></td>
      </tr>
      <tr>
        <td>2교시</td>
        <td id="mon-2"></td>
        <td id="tue-2"></td>
        <td id="wed-2"></td>
        <td id="thu-2"></td>
        <td id="fri-2"></td>
      </tr>
      <tr>
        <td>3교시</td>
        <td id="mon-3"></td>
        <td id="tue-3"></td>
        <td id="wed-3"></td>
        <td id="thu-3"></td>
        <td id="fri-3"></td>
      </tr>
      <tr>
        <td>4교시</td>
        <td id="mon-4"></td>
        <td id="tue-4"></td>
        <td id="wed-4"></td>
        <td id="thu-4"></td>
        <td id="fri-4"></td>
      </tr>
      <tr>
        <td>5교시</td>
        <td id="mon-5"></td>
        <td id="tue-5"></td>
        <td id="wed-5"></td>
        <td id="thu-5"></td>
        <td id="fri-5"></td>
      </tr>
      <tr>
        <td>6교시</td>
        <td id="mon-6"></td>
        <td id="tue-6"></td>
        <td id="wed-6"></td>
        <td id="thu-6"></td>
        <td id="fri-6"></td>
      </tr>
      <tr>
        <td>7교시</td>
        <td id="mon-7"></td>
        <td id="tue-7"></td>
        <td id="wed-7"></td>
        <td id="thu-7"></td>
        <td id="fri-7"></td>
      </tr>
      <tr>
        <td>8교시</td>
        <td id="mon-8"></td>
        <td id="tue-8"></td>
        <td id="wed-8"></td>
        <td id="thu-8"></td>
        <td id="fri-8"></td>
      </tr>
      <tr>
        <td>9교시</td>
        <td id="mon-9"></td>
        <td id="tue-9"></td>
        <td id="wed-9"></td>
        <td id="thu-9"></td>
        <td id="fri-9"></td>
      </tr>
    </table>
  </div>

  <button id="toggleListButton">강의 목록 열기</button>
  <div class="list">
    <!-- 강의 목록을 보여주는 부분 -->
    <div class="head">
      <div class="search-options">
        <label for="department">과 선택:</label>
        <select id="department">
          <option value="">전체</option>
          <option value="1">기계시스템디자인공학과</option>
          <option value="2">기계자동차공학과</option>
          <option value="3">안전공학과</option>
          <option value="4">신소재공학과</option>
          <option value="5">건설시스템공학과</option>
          <option value="6">건축공학전공</option>
          <option value="7">건축학전공</option>
          <option value="8">반도체융합공학전공</option>
          <option value="9">전기정보공학과</option>
          <option value="10">컴퓨터공학과</option>
          <option value="11">스마트ICT융합공학과</option>
          <option value="12">전자공학과</option>
          <option value="13">IT융합소프트웨어전공</option>
          <option value="14">화공생명공학과</option>
          <option value="15">환경공학과</option>
          <option value="16">식품생명공학과</option>
          <option value="17">정밀화학과</option>
          <option value="18">스포츠과학과</option>
          <option value="19">안경광학과</option>
          <option value="20">조형대학</option>
          <option value="21">시각디자인전공</option>
          <option value="22">산업디자인전공</option>
          <option value="23">도예학과</option>
          <option value="24">금속공예디자인학과</option>
          <option value="25">조형예술학과</option>
          <option value="26">영어영문학과</option>
          <option value="27">행정학과</option>
          <option value="28">문예창작학과</option>
          <option value="29">한국문화전공</option>
          <option value="30">산업정보시스템전공</option>
          <option value="31">ITM전공</option>
          <option value="32">경영학전공</option>
          <option value="33">글로벌테크노경영전공</option>
          <option value="34">MSDE학과</option>
          <option value="35">빅데이터경영공학전공</option>
          <option value="36">창업융합전공</option>
          <option value="37">지식재산기술경영전공</option>
          <option value="38">미래융합대학</option>
          <option value="39">융합기계공학과</option>
          <option value="40">헬스피트니스학과</option>
          <option value="41">건설환경융합공학과</option>
          <option value="42">문화예술학과</option>
          <option value="43">영어과</option>
          <option value="44">벤처경영학과</option>
          <option value="45">정보통신융합공학과</option>
          <option value="46">미래에너지융합학과</option>
          <option value="47">지능형반도체공학과</option>
          <option value="48">인공지능응용학과</option>
          <option value="49">창업교육센터</option>
          <option value="50">국제교류처</option>
          <option value="51">교양대학</option>
          <option value="52">글로벌기초교육학부</option>
          <option value="53">글로벌한국어문화학부</option>

        </select>

        <label for="division">이수구분:</label>
        <select id="division">
          <option value="">전체</option>
          <option value="교필">교필</option>
          <option value="기필">기필</option>
          <option value="전필">전필</option>
          <option value="전선">전선</option>
        </select>

        <label for="credit">학점 선택:</label>
        <select id="credit">
          <option value="">전체</option>
          <option value="1">1학점</option>
          <option value="2">2학점</option>
          <option value="3">3학점</option>
          <option value="4">4학점</option>
          <option value="6">6학점</option>
          <option value="12">12학점</option>
        </select>

        <label for="search-option">검색 항목 선택:</label>
        <select id="search-option">
          <option value="courseName">과목명</option>
          <option value="professorName">교수명</option>
          <option value="courseCode">과목코드</option>
          <option value="classroom">강의실</option>
        </select>

        <label for="search-query">검색어 입력:</label>
        <input type="text" id="search-query" placeholder="검색어를 입력하세요" />
        <button class="deleteButton">닫기</button>
        <button id="searchButton">검색</button>

      </div>
      <!-- 태그 정보가 있는 부분 -->
      <div class="tag">
        <div class="tag-item" style="flex: 1;">과</div>
      <div class="tag-item" style="flex: 2;">과목명</div>
      <div class="tag-item" style="flex: 0.5;">이수구분</div>
      <div class="tag-item" style="flex: 1;">담당교수</div>
      <div class="tag-item" style="flex: 0.5;">학점</div>
      <div class="tag-item" style="flex: 0.5;">시간</div>
      <div class="tag-item" style="flex: 0.7;">강의실</div>
        <div class="tag-item" style="flex: 0.5;">수강정원</div>
      </div>
    </div>

    <div class="body">
      <!-- 강의 데이터를 반복적으로 출력 -->
      <ul id="mainList">
        <li th:each="course : ${courses}">
          <div th:text="${course.departmentName}">과</div>
          <div th:text="${course.courseName}">과목명</div>
          <div th:text="${course.division}">이수구분</div>
          <div th:text="${course.professorName}">담당교수</div>
          <div th:text="${course.credit}">학점</div>
          {% if ${course.start_period}==${courses.end_period} %}
            <div th:text="${course.dayOfWeek} + ' ' +${course.start_period}">시간</div>
          {% else %}
            <div th:text="${course.dayOfWeek} + ' ' +${course.start_period} + '-' + ${courses.end_period}">시간</div>
          {% endif %}
          <div th:text="${course.classroom}">강의실</div>
          <div th:text="${course.capacity}">수강정원</div>
        </li>
      </ul>
    </div>
  </div>
</main>
<script src="timetable.js"></script>
<script>


// Flex box 스타일을 저장하는 배열
  const flexBox = [1, 2, 0.5, 1, 0.5, 0.5, 0.7, 0.5, 0.5, 0.5];

  // Toggle button과 mainList 요소를 가져옴
  const toggleButton = document.getElementById('toggleListButton');
  const list = document.querySelector('.list');
  const mainList = document.getElementById('mainList');

  // Toggle button 클릭 시 리스트 표시/숨기기
  toggleButton.addEventListener('click', function () {
    list.style.display = 'block';
    toggleButton.textContent = '강의 목록 열기';
    loadList();
  });

  // 서버에서 데이터를 가져와서 리스트를 만드는 함수
  function loadList() {
    // Fetch API를 사용해 서버에서 강의 데이터를 가져옴
    fetch('http://localhost:8080/courses/list')
            .then(response => {
              if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
              }
              return response.json();
            })
            .then(data => {
              console.log('Fetched data:', data);  // 데이터를 콘솔에 출력해 확인
              makeList(data); // 데이터를 받아와 리스트 생성
            })
            .catch(error => console.error('Error fetching data:', error));
  }

// 리스트를 동적으로 만드는 함수 (다음 항목만 확인하여 강의 시간 병합)
function makeList(data) {
  mainList.innerHTML = ''; // 기존 리스트 초기화

  // 데이터를 순회하면서 다음 항목과 비교
  for (let j = 0; j < data.length; j++) {
    const currentCourse = data[j];

    // 시작 시간과 종료 시간이 같은 경우와 다른 경우에 맞춰 timeString 생성
    let timeString = currentCourse.start_period === currentCourse.end_period
            ? `${currentCourse.dayOfWeek} ${currentCourse.start_period}` // 시작 시간과 종료 시간이 같으면
            : `${currentCourse.dayOfWeek} ${currentCourse.start_period}-${currentCourse.end_period}`; // 시작 시간과 종료 시간이 다르면

    // 다음 항목이 현재 항목과 동일한 수업인지 확인
    if (j + 1 < data.length) {
      const nextCourse = data[j + 1];

      // 동일한 수업인지 확인 (과, 수업정원, 강의실, 교수명, 학점 등 비교)
      if (currentCourse.departmentName === nextCourse.departmentName &&
              currentCourse.courseCode === nextCourse.courseCode &&
              currentCourse.courseName === nextCourse.courseName &&
              currentCourse.courseNumber === nextCourse.courseNumber &&
              currentCourse.professorName === nextCourse.professorName &&
              currentCourse.credit === nextCourse.credit &&
              currentCourse.division === nextCourse.division &&
              currentCourse.capacity === nextCourse.capacity &&
              currentCourse.classroom === nextCourse.classroom) {

        // 다음 강의 시간도 병합
        const nextTimeString = nextCourse.start_period === nextCourse.end_period
                ? `${nextCourse.dayOfWeek} ${nextCourse.start_period}` // 시작 시간과 종료 시간이 같으면
                : `${nextCourse.dayOfWeek} ${nextCourse.start_period}-${nextCourse.end_period}`; // 시작 시간과 종료 시간이 다르면

        timeString += `, ${nextTimeString}`; // 병합된 시간 문자열 추가
        j++; // 이미 병합했으므로 다음 항목을 건너뜀
      }
    }

    // 강의 정보를 표시
    const list = document.createElement('li');
    list.style.display = 'flex'; // Flexbox 설정

    const attributes = [
      { value: currentCourse.departmentName, flex: 1 },
      { value: currentCourse.courseName, flex: 2 },
      { value: currentCourse.division, flex: 0.5 },
      { value: currentCourse.professorName, flex: 1 },
      { value: currentCourse.credit, flex: 0.5 },
      { value: timeString, flex: 0.7 }, // 병합된 시간 문자열
      { value: currentCourse.classroom, flex: 1 },
      { value: currentCourse.capacity, flex: 0.5 }
    ];

    // 각 속성을 리스트에 추가
    attributes.forEach(attr => {
      const div = document.createElement('div');
      div.innerHTML = attr.value ? attr.value : '';
      div.style.flex = attr.flex;
      div.style.textAlign = 'center';
      div.style.padding = '10px 5px';
      div.style.borderRight = '1px solid #ededed';
      list.appendChild(div);
    });

    mainList.appendChild(list); // 리스트 추가
  }
}


</script>

</body>
</html>