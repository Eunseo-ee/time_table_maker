<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Table Filter</title>
    <style>
        /* 스타일 정의 */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .filter-container {
            margin-bottom: 20px;
        }

        .timetable-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr); /* 6열 (시간 + 5요일) */
            grid-auto-rows: 40px; /* 각 셀의 높이 */
            border: 1px solid #333;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .timetable-container div {
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            text-align: center;
        }

        .timetable-header {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .time-slot {
            background-color: #fff;
        }
    </style>
</head>
<body>
<!-- 시간표 모양 -->
<h1>Time Table</h1>
<div class="timetable-container" id="timetable">
    <!-- 시간표 헤더 (시간 및 요일) -->
    <div class="timetable-header">Time</div>
    <div class="timetable-header">Mon</div>
    <div class="timetable-header">Tue</div>
    <div class="timetable-header">Wed</div>
    <div class="timetable-header">Thu</div>
    <div class="timetable-header">Fri</div>

    <!-- 시간표 시간대 -->
    <!-- 반복적으로 시간대를 표시합니다 -->
    <div class="time-slot">9:00</div>
    <div></div><div></div><div></div><div></div><div></div>
    <div class="time-slot">10:00</div>
    <div></div><div></div><div></div><div></div><div></div>
    <div class="time-slot">11:00</div>
    <div></div><div></div><div></div><div></div><div></div>
    <!-- 나머지 시간대 추가 -->
</div>

<!-- 필터 옵션 선택 -->
<h2>Filter Time Table</h2>
<div class="filter-container">
    <form id="filterForm">
        <label for="daysOfWeek">Days of Week (comma separated):</label>
        <input type="text" id="daysOfWeek" name="daysOfWeek" placeholder="월,화"><br><br>

        <label for="startTime">Start Time:</label>
        <input type="number" id="startTime" name="startTime" step="0.5" placeholder="9.0"><br><br>

        <label for="endTime">End Time:</label>
        <input type="number" id="endTime" name="endTime" step="0.5" placeholder="17.0"><br><br>

        <label for="professorName">Professor Name:</label>
        <input type="text" id="professorName" name="professorName"><br><br>

        <label for="courseName">Course Name:</label>
        <input type="text" id="courseName" name="courseName"><br><br>

        <label for="departmentName">Department Name:</label>
        <input type="text" id="departmentName" name="departmentName"><br><br>

        <button type="button" onclick="fetchFilteredCombinations()">Search</button>
    </form>
</div>

<h2>Filtered Results</h2>
<div id="results"></div>

<script>
    function fetchFilteredCombinations() {
        // 입력한 값 가져오기
        const daysOfWeek = document.getElementById('daysOfWeek').value;
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        const professorName = document.getElementById('professorName').value;
        const courseName = document.getElementById('courseName').value;
        const departmentName = document.getElementById('departmentName').value;

        // Fetch API를 사용하여 백엔드 API 호출
        const url = `/courses/filtered?daysOfWeek=${daysOfWeek}&startTime=${startTime}&endTime=${endTime}&professorName=${professorName}&courseName=${courseName}&departmentName=${departmentName}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                // 결과를 표시할 HTML을 만듭니다.
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';  // 기존 결과 지우기

                data.forEach(combination => {
                    const div = document.createElement('div');
                    div.innerHTML = `<strong>Combination:</strong> ${combination.map(course => course.courseName).join(', ')}`;
                    resultsDiv.appendChild(div);
                });

                // 시간표 업데이트
                updateTimetable(data);
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    function updateTimetable(data) {
        const timetable = document.getElementById('timetable');
        // 모든 셀 초기화
        timetable.querySelectorAll('div:not(.timetable-header):not(.time-slot)').forEach(cell => {
            cell.innerHTML = '';
        });

        // 수업 데이터를 시간표에 표시
        data.forEach(combination => {
            combination.forEach(course => {
                const dayIndex = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'].indexOf(course.dayOfWeek);
                const timeSlot = course.startPeriod; // 수업 시작 시간
                const cellIndex = dayIndex + timeSlot * 6; // 셀 위치 계산

                // 해당 셀에 수업 정보를 입력
                timetable.children[cellIndex].innerHTML = course.courseName + "<br>" + course.professorName;
            });
        });
    }
</script>
</body>
</html>
